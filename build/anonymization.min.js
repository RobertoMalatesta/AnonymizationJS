!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){(function(t){var n=r(1),i=r(3),a=r(4),o="undefined"!=typeof window?window:t;o.Anonymity={GenHierarchy:{String:n.StringGenHierarchy,Category:n.ContGenHierarchy},Input:{Csv:i.CSV},Algorithms:{Sangreea:a.SaNGreeA}},e.exports={$G:o.$G}}).call(t,function(){return this}())},function(e,t,r){"use strict";var n=r(2),i=function(){function e(e){this.filePath=e,this._entries={},this._nr_levels=0;var t=JSON.parse(n.readFileSync(e).toString());this._name=t.name,this.readFromJson(t)}return e.prototype.readFromJson=function(e){var t=0;for(var r in e.entries){var n=e.entries[r],i=+n.level;0===i&&t++,i>this._nr_levels&&(this._nr_levels=i);var a={name:n.name,gen:n.gen,level:n.level};this._entries[r]=a}if(1!==t)throw new Error("JSON invalid. Level 0 must contain exactly 1 entry.")},e.prototype.nrLevels=function(){return this._nr_levels},e.prototype.getEntries=function(){return this._entries},e.prototype.getLevelEntry=function(e){return this._entries[e]?this._entries[e].level:void 0},e.prototype.getGeneralizationOf=function(e){return this._entries[e]?this._entries[e].gen:void 0},e.prototype.getName=function(e){return this._entries[e].name},e}();t.StringGenHierarchy=i;var a=function(){function e(e,t,r){if(this._name=e,this._min=t,this._max=r,t>r)throw new Error("Range invalid. Min greater than Max.");if(t===r)throw new Error("Range invalid. Min equals Max.")}return e.prototype.genCostOfRange=function(e,t){if(e>t)throw new Error("Cannot generalize to negative range.");if(e<this._min)throw new Error("Cannot generalize span. From parameter less than range min.");if(t>this._max)throw new Error("Cannot generalize span. To parameter greater than range max.");return(t-e)/(this._max-this._min)},e}();t.ContGenHierarchy=a},function(e,t){},function(e,t){"use strict";var r=function(){function e(e){void 0===e&&(e=","),this._sep=e}return e.prototype.readCSV=function(){},e}();t.CSV=r},function(e,t,r){"use strict";var n=r(2),i=r(1),a=r(!function(){var e=new Error('Cannot find module "graphinius"');throw e.code="MODULE_NOT_FOUND",e}()).$G;console.log(a),function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.CATEGORICAL=1]="CATEGORICAL"}(t.HierarchyType||(t.HierarchyType={}));var o=(t.HierarchyType,function(){function e(e,t,r,n){if(void 0===e&&(e="default"),this._name=e,this._input_file=t,this._cont_hierarchies={},this._cat_hierarchies={},this._weights=n||{age:1/6,workclass:1/6,"native-country":1/6,sex:1/6,race:1/6,"marital-status":1/6},""===t)throw new Error("Input file cannot be an empty string");if(this._options=r||{nr_draws:300,edge_min:1,edge_max:10},this._options.nr_draws<0)throw new Error("Options invalid. Nr_draws can not be negative.");if(this._options.edge_min<0)throw new Error("Options invalid. Edge_min can not be negative.");if(this._options.edge_max<0)throw new Error("Options invalid. Edge_max can not be negative.");if(this._options.edge_max<this._options.edge_min)throw new Error("Options invalid. Edge_max cannot exceed edge_min.")}return e.prototype.getOptions=function(){return this._options},e.prototype.getContHierarchies=function(){return this._cont_hierarchies},e.prototype.getCatHierarchies=function(){return this._cat_hierarchies},e.prototype.getContHierarchy=function(e){return this._cont_hierarchies[e]},e.prototype.getCatHierarchy=function(e){return this._cat_hierarchies[e]},e.prototype.setContHierarchy=function(e,t){this._cont_hierarchies[e]=t},e.prototype.setCatHierarchy=function(e,t){this._cat_hierarchies[e]=t},e.prototype.instantiateGraph=function(e){void 0===e&&(e="default"),this._graph=new a.core.Graph("adults"),this.readCSV(this._input_file,this._graph),this._graph.createRandomEdgesSpan(this._options.edge_min,this._options.edge_max,!1)},e.prototype.readCSV=function(e,t){var r=n.readFileSync(e).toString().split("\n"),a=r.shift().replace(/\s+/g,"").split(","),o=Object.keys(this._cont_hierarchies),s=Object.keys(this._cat_hierarchies),h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,g={};a.forEach(function(e,t){-1!==o.indexOf(e)&&(g[t]=e)});var u={};a.forEach(function(e,t){-1!==s.indexOf(e)&&(u[t]=e)});for(var p=300,l=0;p>l;l++)if(r[l]){var _=r[l].replace(/\s+/g,"").split(","),f=!0;for(var v in u){var y=this.getCatHierarchy(u[v]);y&&!y.getLevelEntry(_[v])&&(f=!1)}for(var v in g){this.getContHierarchy(g[v]);+_[v]!==+_[v]&&(f=!1)}if(f){var d=this._graph.addNode(l);for(var v in u)d.setFeature(u[v],_[v]);for(var v in g)d.setFeature(g[v],+_[v]);var m=parseInt(_[0]);h=h>m?m:h,c=m>c?m:c,d.setFeature("age",parseInt(_[0]))}else p++}var C=new i.ContGenHierarchy("age",h,c);this.setContHierarchy("age",C)},e.prototype.outputPreprocCSV=function(e){var t="",r=this._graph.getNodes(),i=null;for(var a in this._graph.getNodes())i=r[a],t+=i.getID()+",",t+=i.getFeature("age")+",",t+=i.getFeature("workclass")+",",t+=i.getFeature("native-country")+",",t+=i.getFeature("sex")+",",t+=i.getFeature("race")+",",t+=i.getFeature("marital-status"),t+="\n";var o="nodeID, age, workclass, native-country, sex, race, marital-status \n";t=o+t,n.writeFileSync("./test/io/test_output/"+e+".csv",t)},e.prototype.outputAnonymizedCSV=function(e){var t="";for(var r in this._clusters){var i=this._clusters[r];for(var a in i.nodes){var o=i.gen_ranges.age;t+=o[0]===o[1]?o[0]+", ":"["+o[0]+" - "+o[1]+"], ";for(var s in this._cat_hierarchies){var h=this._cat_hierarchies[s];t+=h.getName(i.gen_feat[s])+", "}t=t.slice(0,-2)+"\n"}}var c="age, workclass, native-country, sex, race, marital-status \n";t=c+t,n.writeFileSync("./test/io/test_output/"+e+".csv",t)},e.prototype.anonymizeGraph=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=0);var n,i,a,o,s,h,c,g,u=[],p=this._graph.getNodes(),l=Object.keys(p),_={};for(c=0;c<l.length;c++)if(n=p[l[c]],!_[n.getID()]){var f={nodes:{},gen_feat:{workclass:n.getFeature("workclass"),"native-country":n.getFeature("native-country"),"marital-status":n.getFeature("marital-status"),sex:n.getFeature("sex"),race:n.getFeature("race")},gen_ranges:{age:[n.getFeature("age"),n.getFeature("age")]}};for(f.nodes[n.getID()]=n,_[n.getID()]=!0;Object.keys(f.nodes).length<e&&c<l.length;){for(h=Number.POSITIVE_INFINITY,g=0;g<l.length;g++)i=p[l[g]],_[i.getID()]||(s=this.calculateCatCosts(f,i),o=this.calculateContCosts(f,i),h>s+o&&(h=s+o,a=i));f.nodes[a.getID()]=a,this.updateRange(f.gen_ranges.age,a.getFeature("age")),this.updateLevels(f,a),_[a.getID()]=!0}u.push(f)}console.log("Built "+u.length+" clusters."),this._clusters=u},e.prototype.updateLevels=function(e,t){for(var r in this._cat_hierarchies){for(var n=this.getCatHierarchy(r),i=e.gen_feat[r],a=t.getFeature(r),o=n.getLevelEntry(i),s=n.getLevelEntry(a);i!==a;)a=n.getGeneralizationOf(a),s=n.getLevelEntry(a),o>s&&(i=n.getGeneralizationOf(i),o=n.getLevelEntry(i));e.gen_feat[r]=i}},e.prototype.calculateCatCosts=function(e,t){var r=0;for(var n in this._cat_hierarchies){for(var i=this.getCatHierarchy(n),a=e.gen_feat[n],o=t.getFeature(n),s=i.getLevelEntry(a),h=i.getLevelEntry(o);a!==o;)o=i.getGeneralizationOf(o),h=i.getLevelEntry(o),s>h&&(a=i.getGeneralizationOf(a),s=i.getLevelEntry(a));r+=this._weights[n]*((i.nrLevels()-s)/i.nrLevels())}return r/Object.keys(this._cat_hierarchies).length},e.prototype.calculateContCosts=function(e,t){var r=e.gen_ranges.age,n=this.expandRange(r,t.getFeature("age")),a=this.getContHierarchy("age"),o=a instanceof i.ContGenHierarchy?a.genCostOfRange(n[0],n[1]):0;return this._weights.age*o},e.prototype.expandRange=function(e,t){var r=t<e[0]?t:e[0],n=t>e[1]?t:e[1];return[r,n]},e.prototype.updateRange=function(e,t){e[0]<e[0]?t:e[0],e[1]=t>e[1]?t:e[1]},e}());t.SaNGreeA=o}]);