!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){(function(t){var n=r(1),a=r(3),i=r(4),o="undefined"!=typeof window?window:t;o.Anonymity={GenHierarchy:{String:n.StringGenHierarchy,Category:n.ContGenHierarchy},Input:{Csv:a.CSV},Algorithms:{Sangreea:i.SaNGreeA}},e.exports={$G:o.$G}}).call(t,function(){return this}())},function(e,t,r){"use strict";var n=r(2),a=function(){function e(e){this.filePath=e,this._entries={},this._nr_levels=0;var t=JSON.parse(n.readFileSync(e).toString());this._name=t.name,this.readFromJson(t)}return e.prototype.readFromJson=function(e){var t=0;for(var r in e.entries){var n=e.entries[r],a=+n.level;0===a&&t++,a>this._nr_levels&&(this._nr_levels=a);var i={name:n.name,gen:n.gen,level:n.level};this._entries[r]=i}if(1!==t)throw new Error("JSON invalid. Level 0 must contain exactly 1 entry.")},e.prototype.nrLevels=function(){return this._nr_levels},e.prototype.getEntries=function(){return this._entries},e.prototype.getLevelEntry=function(e){return this._entries[e]?this._entries[e].level:void 0},e.prototype.getGeneralizationOf=function(e){return this._entries[e]?this._entries[e].gen:void 0},e.prototype.getName=function(e){return this._entries[e].name},e}();t.StringGenHierarchy=a;var i=function(){function e(e,t,r){if(this._name=e,this._min=t,this._max=r,t>r)throw new Error("Range invalid. Min greater than Max.");if(t===r)throw new Error("Range invalid. Min equals Max.")}return e.prototype.genCostOfRange=function(e,t){if(e>t)throw new Error("Cannot generalize to negative range.");if(e<this._min)throw new Error("Cannot generalize span. From parameter less than range min.");if(t>this._max)throw new Error("Cannot generalize span. To parameter greater than range max.");return(t-e)/(this._max-this._min)},e}();t.ContGenHierarchy=i},function(e,t){},function(e,t){"use strict";var r=function(){function e(e){void 0===e&&(e=","),this._sep=e}return e.prototype.readCSV=function(){},e}();t.CSV=r},function(e,t,r){"use strict";var n=r(2),a=r(1),i=r(5),o=r(!function(){var e=new Error('Cannot find module "graphinius"');throw e.code="MODULE_NOT_FOUND",e}()).$G;!function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.CATEGORICAL=1]="CATEGORICAL"}(t.HierarchyType||(t.HierarchyType={}));var s=(t.HierarchyType,function(){function e(e,t,r){if(void 0===e&&(e="default"),this._name=e,this._input_file=t,this.config=r,this._cont_hierarchies={},this._cat_hierarchies={},this._config=r||i.CONFIG,""===t)throw new Error("Input file cannot be an empty string");if(this._config.NR_DRAWS<0)throw new Error("Options invalid. Nr_draws can not be negative.");if(this._config.EDGE_MIN<0)throw new Error("Options invalid. Edge_min can not be negative.");if(this._config.EDGE_MAX<0)throw new Error("Options invalid. Edge_max can not be negative.");if(this._config.EDGE_MAX<this._config.EDGE_MIN)throw new Error("Options invalid. Edge_min cannot exceed edge_max.");this._graph=new o.core.Graph(this._name)}return e.prototype.getConfig=function(){return this._config},e.prototype.getContHierarchies=function(){return this._cont_hierarchies},e.prototype.getCatHierarchies=function(){return this._cat_hierarchies},e.prototype.getContHierarchy=function(e){return this._cont_hierarchies[e]},e.prototype.getCatHierarchy=function(e){return this._cat_hierarchies[e]},e.prototype.setContHierarchy=function(e,t){this._cont_hierarchies[e]=t},e.prototype.setCatHierarchy=function(e,t){this._cat_hierarchies[e]=t},e.prototype.instantiateGraph=function(e){void 0===e&&(e=!0),this.readCSV(this._input_file,this._graph),e===!0&&this._graph.createRandomEdgesSpan(this._config.EDGE_MIN,this._config.EDGE_MAX,!1)},e.prototype.readCSV=function(e,t){var r=n.readFileSync(e).toString().split("\n"),i=r.shift().replace(/\s+/g,"").split(","),o=Object.keys(this._cont_hierarchies),s=Object.keys(this._cat_hierarchies),c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,g={};i.forEach(function(e,t){-1!==o.indexOf(e)&&(g[t]=e)});var u={};i.forEach(function(e,t){-1!==s.indexOf(e)&&(u[t]=e)});for(var _=this._config.NR_DRAWS,f=0;_>f;f++)if(r[f]){var l=r[f].replace(/\s+/g,"").split(","),p=!0;for(var v in u){var y=this.getCatHierarchy(u[v]);y&&!y.getLevelEntry(l[v])&&(p=!1)}for(var v in g){this.getContHierarchy(g[v]);+l[v]!==+l[v]&&(p=!1)}if(p){var E=this._graph.addNode(f);for(var v in u)E.setFeature(u[v],l[v]);for(var v in g)E.setFeature(g[v],+l[v]);E.setFeature("income",l[l.length-1]);var d=parseInt(l[0]);c=c>d?d:c,h=d>h?d:h,E.setFeature("age",parseInt(l[0]))}else _++}var m=new a.ContGenHierarchy("age",c,h);this.setContHierarchy("age",m)},e.prototype.outputPreprocCSV=function(e,t){var r="",a=this._graph.getNodes(),i=null,o=0;for(var s in this._graph.getNodes()){i=a[s];var c=parseFloat(t.prob),h=t.feat,g=t.value;t&&null!=c&&null!=h&&null!=g&&Math.random()<c&&i.getFeature(h)===g?o++:(r+=i.getID()+",",r+=i.getFeature("age")+",",r+=i.getFeature("workclass")+",",r+=i.getFeature("native-country")+",",r+=i.getFeature("sex")+",",r+=i.getFeature("race")+",",r+=i.getFeature("marital-status")+",",r+=i.getFeature("income"),r+="\n")}var u="nodeID, age, workclass, native-country, sex, race, marital-status, income \n";r=u+r,console.log("Eliminated "+o+" rows from a DS of "+this._graph.nrNodes()+" rows."),n.writeFileSync("./test/io/test_output/"+e+".csv",r)},e.prototype.outputAnonymizedCSV=function(e){var t="";for(var r in this._clusters){var a=this._clusters[r],i=a.nodes;for(var o in i){var s=a.gen_ranges.age;if(s[0]===s[1])t+=s[0]+", ";else if(this._config.AVERAGE_OUTPUT_RANGES){var c=(s[0]+s[1])/2;t+=c+", "}else t+="["+s[0]+" - "+s[1]+"], ";for(var h in this._cat_hierarchies){var g=this._cat_hierarchies[h];t+=g.getName(a.gen_feat[h])+", "}t+=i[o].getFeature("income"),t+="\n"}}var u="age, workclass, native-country, sex, race, marital-status, income \n";t=u+t,n.writeFileSync("./test/io/test_output/"+e+".csv",t)},e.prototype.anonymizeGraph=function(){var e,t,r,n,a,i,o,s,c,h,g,u=[],_=this._graph.getNodes(),f=Object.keys(_),l={},p=Object.keys(_).length;for(h=0;h<f.length;h++)if(e=_[f[h]],!l[e.getID()]){var v={nodes:{},gen_feat:{workclass:e.getFeature("workclass"),"native-country":e.getFeature("native-country"),"marital-status":e.getFeature("marital-status"),sex:e.getFeature("sex"),race:e.getFeature("race")},gen_ranges:{age:[e.getFeature("age"),e.getFeature("age")]}};for(v.nodes[e.getID()]=e,l[e.getID()]=!0,p--;Object.keys(v.nodes).length<this._config.K_FACTOR&&p;){for(c=Number.POSITIVE_INFINITY,g=h+1;g<f.length;g++)t=_[f[g]],l[t.getID()]||(a=this.calculateCatCosts(v,t),n=this.calculateContCosts(v,t),i=a+n,o=this._config.BETA>0?this.calculateSIL(v,t):0,s=this._config.ALPHA*i+this._config.BETA*o,c>s&&(c=s,r=t));v.nodes[r.getID()]=r,this.updateRange(v.gen_ranges.age,r.getFeature("age")),this.updateLevels(v,r),l[r.getID()]=!0,p--}u.push(v)}console.log("Built "+u.length+" clusters."),this._clusters=u},e.prototype.calculateSIL=function(e,t){var r=this._graph.nrNodes()-2,n=[],a=t.reachNodes().map(function(e){return e.node.getID()});for(var i in e.nodes){var o=r,s=e.nodes[i].reachNodes().map(function(e){return e.node.getID()});for(var c in s){var h=s[c];h!==t.getID()&&-1!==a.indexOf(h)&&--o}n.push(o/r)}return n.reduce(function(e,t){return e+t},0)/n.length},e.prototype.updateLevels=function(e,t){for(var r in this._cat_hierarchies){for(var n=this.getCatHierarchy(r),a=e.gen_feat[r],i=t.getFeature(r),o=n.getLevelEntry(a),s=n.getLevelEntry(i);a!==i;)i=n.getGeneralizationOf(i),s=n.getLevelEntry(i),o>s&&(a=n.getGeneralizationOf(a),o=n.getLevelEntry(a));e.gen_feat[r]=a}},e.prototype.calculateCatCosts=function(e,t){var r=0;for(var n in this._cat_hierarchies){for(var a=this.getCatHierarchy(n),i=e.gen_feat[n],o=t.getFeature(n),s=a.getLevelEntry(i),c=a.getLevelEntry(o);i!==o;)o=a.getGeneralizationOf(o),c=a.getLevelEntry(o),s>c&&(i=a.getGeneralizationOf(i),s=a.getLevelEntry(i));var h=this._config.GEN_WEIGHT_VECTORS[this._config.VECTOR].categorical;r+=h[n]*((a.nrLevels()-s)/a.nrLevels())}return r/Object.keys(this._cat_hierarchies).length},e.prototype.calculateContCosts=function(e,t){var r=e.gen_ranges.age,n=this.expandRange(r,t.getFeature("age")),i=this.getContHierarchy("age"),o=i instanceof a.ContGenHierarchy?i.genCostOfRange(n[0],n[1]):0,s=this._config.GEN_WEIGHT_VECTORS[this._config.VECTOR].range;return s.age*o},e.prototype.expandRange=function(e,t){var r=t<e[0]?t:e[0],n=t>e[1]?t:e[1];return[r,n]},e.prototype.updateRange=function(e,t){e[0]<e[0]?t:e[0],e[1]=t>e[1]?t:e[1]},e}());t.SaNGreeA=s},function(e,t){"use strict";var r={INPUT_FILE:"",TARGET_COLUMNS:["income"],AVERAGE_OUTPUT_RANGES:!0,NR_DRAWS:300,RANDOM_DRAWS:!1,EDGE_MIN:3,EDGE_MAX:10,K_FACTOR:25,ALPHA:1,BETA:0,GEN_WEIGHT_VECTORS:{equal:{categorical:{workclass:1/6,"native-country":1/6,sex:1/6,race:1/6,"marital-status":1/6},range:{age:1/6}},emph_race:{categorical:{workclass:.02,"native-country":.02,sex:.02,race:.9,"marital-status":.02},range:{age:.02}},emph_age:{categorical:{workclass:.02,"native-country":.02,sex:.02,race:.02,"marital-status":.02},range:{age:.9}}},VECTOR:"equal"};t.CONFIG=r}]);